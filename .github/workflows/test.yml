name: Test Action

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Create test Terraform file
        run: |
          mkdir -p test
          cat > test/main.tf << 'EOF'
          resource "aws_instance" "example" {
            ami           = "ami-12345678"
            instance_type = "t2.micro"
          }
          EOF
      
      - name: Create test config
        run: |
          cat > .terratags.yaml << 'EOF'
          required_tags:
            - Environment
            - ManagedBy
          EOF
      
      - name: Test action
        continue-on-error: true
        id: terratags-test
        uses: ./
        with:
          config: '.terratags.yaml'
          dir: './test'
          verbose: true
      
      - name: Verify expected failure
        run: |
          if [ "${{ steps.terratags-test.outcome }}" = "failure" ]; then
            echo "✅ Test passed: Terratags correctly identified missing tags"
          else
            echo "❌ Test failed: Expected terratags to fail but it succeeded"
            exit 1
          fi
